function getQuery(a) { var b = location.search.match(new RegExp(a + "=(.*?)($|&)", "i")); return b ? b[1] : !1 } function t(a, b) { return "undefined" != typeof NEXSO.i18n[a] && "undefined" != typeof NEXSO.i18n[a][b] ? NEXSO.i18n[a][b] : a } var NEXSO = { i18n: NEXSO.i18n, api: { solutions: "/DesktopModules/NexsoServices/API/Nexso/GetSolutions", tpl: "/Portals/0/Skins/NexsoV2/resources/" }, base_path:window.location.protocol+"//"+window.location.host, language: $('input[name="CurrentLanguage"]').val() ? $('input[name="CurrentLanguage"]').val() : "en-US", uid: getQuery("ui") !== !1 ? $('input[name="CurrentUserId"]').val() : -1 }; $(function () { Handlebars.registerHelper("i18n", function (a) { return t(a, NEXSO.language) }), Handlebars.registerHelper("ucfirst", function (a) { return a = a.toLowerCase(), a.charAt(0).toUpperCase() + a.slice(1) }), Handlebars.registerHelper("is_draft", function (a, b) { return 800 > a ? b.fn(this) : b.inverse(this) }), Handlebars.registerHelper("times", function (a, b) { for (var c = "", d = 0; a > d; ++d) c += b.fn(d); return c }) }); var Solutions = function (a) { this.container = a.container, this.api = a.api || NEXSO.base_path + NEXSO.api.solutions, this.loadMore = "undefined" == typeof a.loadMore ? !0 : a.loadMore, this.pageSize = "undefined" == typeof a.pageSize ? 3 : a.pageSize, this.placeholders = "undefined" == typeof a.placeholders ? 3 : a.placeholders, this.filters = a.filters || [], this.controls = {}; var b = [], c = this, d = NEXSO.api.tpl, e = null, f = 1; this.init = function () { return null !== e ? c.requestAndRender() : void async.parallel([function (a) { $.get(d + "solution-list.tpl.html").success(function (b) { e = Handlebars.compile(b), a(null) }).fail(function () { a("Error fetching the template") }) }, function (a) { c.loadPartial("solution", a) }, function (a) { c.loadPartial("solution-placeholder", a) }], function (a) { if (a) throw a; c.requestAndRender() }) }, this.setFilters = function (a) { this.filters = a, b = [], f = 1 }, this.requestAndRender = function () { c.render(!0), c.requestSolutions(function () { c.render() }) }, this.loadPartial = function (a, b) { $.get(d + a + ".part.html").success(function (c) { Handlebars.registerPartial(a, c), b(null) }).fail(function () { b("Error fetching partial") }) }, this.render = function (a) { a = a || !1, this.container.html(e({ solutions: b, showLoadMore: this.loadMore, placeholders: a ? this.placeholders : 0 })), this.loadMore && (this.controls.loadMore = this.container.find(".js-load-more"), this.controls.loadMore.click(function (a) { a.preventDefault(), c.controls.loadMore.hasClass("disabled") || c.next() })) }, this.requestSolutions = function (a) { $.get(this.api, { language: NEXSO.language, rows: c.pageSize, page: f, min: 0, max: 0, state: 1e3, userId: NEXSO.uid, filter: JSON.stringify(c.filters) }, function (c) { c = JSON.parse(c), $.merge(b, c), a(c) }, "json") }, this.next = function () { f++, c.render(!0), c.requestSolutions(function (a) { c.render(), 0 === a.length && c.controls.loadMore.addClass("disabled") }) }, this.reset = function () { b = [], f = 1, c.requestAndRender() } };